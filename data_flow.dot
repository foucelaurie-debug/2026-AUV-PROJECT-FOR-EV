digraph AUV_Data_Flow {
    comment = "AUV Project Data Flow"
    rankdir = TB
    splines = ortho
    node [shape=box, style=rounded]

    subgraph cluster_hardware {
        style = filled
        color = lightgrey
        label = "物理硬件层 (Hardware Layer)"
        hw_cam [label="立体摄像头\n(Stereo Cameras)", shape=cylinder, color=blue]
        hw_mcu [label="微控制器\n(H750/F407 MCUs)", shape=cylinder, color=blue]
    }

    subgraph cluster_ros_nodes {
        label = "ROS 2 节点层 (ROS 2 Nodes)"
        subgraph cluster_perception {
            label = "感知 (Perception)"
            color = seagreen
            style = filled
            n_capture [label=uv_capture]
            n_detect [label=uv_detect_demo]
            n_segment [label=uv_segment]
        }

        subgraph cluster_decision {
            label = "决策 (Decision - Inferred)"
            color = skyblue
            style = filled
            n_automaton [label="uv_automaton\n(任务状态机)"]
        }

        subgraph cluster_control {
            label = "硬件管理 (Hardware Management)"
            color = orange
            style = filled
            n_core [label=uv_core]
        }
    }

    hw_cam -> n_capture [label=" 原始图像流\n(Raw Video)"]
    n_capture -> n_detect [label=" /front_cam/rectified\n/down_cam/rectified\n(sensor_msgs/Image)"]
    n_capture -> n_segment [label=" /down_cam/rectified/left\n(sensor_msgs/Image)"]
    n_detect -> n_automaton [label=" /uv_detect_front\n/uv_detect_down\n(uv_msgs/Yolov8)"]
    n_segment -> n_automaton [label=" /binary_segment_img\n(sensor_msgs/Image)"]
    n_automaton -> n_core [label=" /target_pos_down\n/openloop_thrust\n(控制指令)"]
    n_core -> n_automaton [label=" /motion_controller\n/device_manager\n(AUV状态)"]
    n_core -> hw_mcu [label=" 二进制指令\n(Serial Commands)"]
    hw_mcu -> n_core [label=" 二进制状态\n(Serial Data)"]
}
